(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{583:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"跨域的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域的方法"}},[s._v("#")]),s._v(" 跨域的方法")]),s._v(" "),a("h2",{attrs:{id:"备注"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备注"}},[s._v("#")]),s._v(" 备注")]),s._v(" "),a("ol",[a("li",[s._v("端口和协议的不同，只能通过后台来解决")]),s._v(" "),a("li",[s._v("localhost和127.0.0.1虽然都指向本机，但也属于跨域")])]),s._v(" "),a("h2",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[s._v("#")]),s._v(" 跨域")]),s._v(" "),a("p",[s._v("当"),a("code",[s._v("协议")]),s._v("、"),a("code",[s._v("子域名")]),s._v("、"),a("code",[s._v("主域名")]),s._v("、"),a("code",[s._v("端口号")]),s._v("中任意一个不相同时，都算作不同域。")]),s._v(" "),a("p",[s._v("不同域之间相互请求资源，就算作"),a("code",[s._v("跨域")])]),s._v(" "),a("ul",[a("li",[a("p",[s._v("跨域并不是请求发不出去，"),a("code",[s._v("请求能发出去")]),s._v("，服务端能收到请求并"),a("code",[s._v("正常返回结果")]),s._v("，只是结果"),a("code",[s._v("被浏览器拦截")]),s._v("了。")])]),s._v(" "),a("li",[a("p",[s._v("之所以会跨域，是因为受到了同源策略的限制，同源策略要求源相同才能正常进行通信，即"),a("code",[s._v("协议")]),s._v("、"),a("code",[s._v("域名")]),s._v("、"),a("code",[s._v("端口号")]),s._v("都完全一致。")])])]),s._v(" "),a("p",[s._v("同源策略限制内容有："),a("code",[s._v("Cookie")]),s._v("、"),a("code",[s._v("LocalStorage")]),s._v("、"),a("code",[s._v("IndexedDB")]),s._v(" 等存储性内容"),a("code",[s._v("DOM 节点``AJAX 请求不能发送")])]),s._v(" "),a("p",[s._v("但是有三个标签是允许跨域加载资源：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("<img src=XXX>")])]),s._v(" "),a("li",[a("code",[s._v("<link href=XXX>")])]),s._v(" "),a("li",[a("code",[s._v("<script src=XXX>")])])]),s._v(" "),a("h2",{attrs:{id:"处理跨域的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理跨域的方法"}},[s._v("#")]),s._v(" 处理跨域的方法")]),s._v(" "),a("h3",{attrs:{id:"_1、webpack-proxy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、webpack-proxy"}},[s._v("#")]),s._v(" 1、webpack proxy")]),s._v(" "),a("h3",{attrs:{id:"_2、nginx-反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、nginx-反向代理"}},[s._v("#")]),s._v(" 2、nginx 反向代理")]),s._v(" "),a("h3",{attrs:{id:"_3、jsonp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、jsonp"}},[s._v("#")]),s._v(" 3、Jsonp")]),s._v(" "),a("p",[s._v("代码示例：")]),s._v(" "),a("p",[s._v("后端:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("router"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/hehe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" obj "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'callbackFunction('")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("obj"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("')'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//需要将对象转为字符串；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("前端使用jquery的ajax的jsonp:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ajax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:3000/index/hehe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//跨域请求的地址，也可用相对路径js/data.js")]),s._v("\n        type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        dataType"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jsonp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//使用jsonp跨域请求")]),s._v("\n        jsonpCallback"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'callbackFunction'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("done")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 控制台打印结果{0: "a", 1: "b", 2: "c"}')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("fail")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"error"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("ol",[a("li",[s._v("利用"),a("code",[s._v("<script>")]),s._v(" 元素的这个开放策略，网页可以得到从其他来源动态产生的 JSON 数据。JSONP请求一定需要对方的服务器做支持才可以。")]),s._v(" "),a("li",[s._v("JSONP由两部分组成："),a("code",[s._v("回调函数")]),s._v("和"),a("code",[s._v("数据")]),s._v("。回调函数是当响应到来时应该在页面中调用的函数，而数据就是传入回调函数中的JSON数据。")])]),s._v(" "),a("h4",{attrs:{id:"jsonp和ajax对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp和ajax对比"}},[s._v("#")]),s._v(" JSONP和AJAX对比")]),s._v(" "),a("p",[s._v("JSONP和AJAX相同，都是客户端向服务器端发送请求，从服务器端获取数据的方式。但"),a("code",[s._v("AJAX属于同源策略")]),s._v("，"),a("code",[s._v("JSONP属于非同源策略（跨域请求）")])]),s._v(" "),a("h4",{attrs:{id:"jsonp优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp优缺点"}},[s._v("#")]),s._v(" JSONP优缺点")]),s._v(" "),a("ul",[a("li",[s._v("优点：兼容性好，在很古老的浏览器中也可以用，简单易用，支持浏览器与服务器双向通信。 可用于解决主流浏览器的跨域数据访问的问题")]),s._v(" "),a("li",[s._v("缺点："),a("code",[s._v("只支持GET请求")]),s._v("，且"),a("code",[s._v("只支持跨域HTTP请求这种情况（不支持HTTPS）")])])]),s._v(" "),a("h4",{attrs:{id:"json、jsonp的区别："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json、jsonp的区别："}},[s._v("#")]),s._v(" JSON、JSONP的区别：")]),s._v(" "),a("ol",[a("li",[s._v("JSON返回的是一串数据、JSONP返回的是"),a("em",[s._v("脚本代码")]),s._v("(包含一个函数调用)")]),s._v(" "),a("li",[s._v("JSONP 只支持get请求、不支持post请求")])]),s._v(" "),a("p",[s._v("(类似往页面添加一个script标签，通过src属性去触发对指定地址的请求,故只能是Get请求)")]),s._v(" "),a("h4",{attrs:{id:"jsonp改成post请求的方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jsonp改成post请求的方法"}},[s._v("#")]),s._v(" jsonp改成post请求的方法")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("客户端更改\n添加：crossDomain:true;\n修改：dataType：'json'")])]),s._v(" "),a("li",[a("p",[s._v("服务端添加\nheader('Access-Control-Allow-Origin:'*');\nheader('Access-Control-Allow-Methodes:''POST');\nheader('Access-Control-Max-Age:'1000')")])])]),s._v(" "),a("h3",{attrs:{id:"_4、cors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、cors"}},[s._v("#")]),s._v(" 4、CORS")]),s._v(" "),a("blockquote",[a("p",[s._v("整个CORS通信过程，都是浏览器自动完成，不需要用户参与。CORS通信的关键是服务器。只要服务器实现了CORS接口，就可以跨源通信。")])]),s._v(" "),a("h4",{attrs:{id:"核心思想"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心思想"}},[s._v("#")]),s._v(" 核心思想")]),s._v(" "),a("p",[s._v("在服务器端通过检查请求头部的origin，从而决定请求应该成功还是失败。")]),s._v(" "),a("p",[s._v("具体的方法是在服务端设置Response Header响应头中的"),a("code",[s._v("Access-Control-Allow-Origin")]),s._v("为对应的域名，实现了CORS（跨域资源共享），这里出于在安全性方面的考虑就是尽量不要用 *")]),s._v(" "),a("h4",{attrs:{id:"cors优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cors优缺点"}},[s._v("#")]),s._v(" CORS优缺点")]),s._v(" "),a("ul",[a("li",[s._v("CORS要求浏览器(>IE10)和服务器的同时支持，是"),a("code",[s._v("跨域的根本解决方法")]),s._v("，由浏览器自动完成。")]),s._v(" "),a("li",[s._v("优点在于功能更加强大支持各种HTTP Method，"),a("code",[s._v("缺点是兼容性不如JSONP")]),s._v("。")])]),s._v(" "),a("h3",{attrs:{id:"_5、通过document-domain来跨子域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、通过document-domain来跨子域"}},[s._v("#")]),s._v(" 5、通过document.domain来跨子域")]),s._v(" "),a("p",[s._v("我们只要把"),a("code",[s._v("http://www.example.com/a.html")]),s._v("和 "),a("code",[s._v("http://example.com/b.html")]),s._v("这两个页面的"),a("code",[s._v("document.domain")]),s._v("都设成"),a("em",[s._v("相同的域名")]),s._v("就可以了。")]),s._v(" "),a("blockquote",[a("p",[s._v("但要注意的是，document.domain的设置是有限制的，我们只能把"),a("em",[s._v("document.domain设置成自身或更高一级的父域，且主域必须相同。")])])]),s._v(" "),a("p",[s._v("修改document.domain的方法只适用于不同子域的框架间的交互。")]),s._v(" "),a("h3",{attrs:{id:"_6、使用window-name-iframe来进行跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、使用window-name-iframe来进行跨域"}},[s._v("#")]),s._v(" 6、使用window.name+iframe来进行跨域")]),s._v(" "),a("p",[s._v("a页面的值传给b页面；")]),s._v(" "),a("p",[s._v("给a页面设置window.name的值；")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello world'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("b页面写一个ifram:")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("iframe")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("http://localhost:8080/config/catalog.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("iframe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" ifr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'iframe'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ifr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("onload")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'跨域获取数据'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ifr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//b页面就得到了a页面的数据，为：hello world")]),s._v("\n        ifr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每当改变location的时候，就会重新来一次onload，所以我们希望获取到数据之后，就直接close()")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("window对象有个name属性，该属性有个特征：即在一个窗口(window)的生命周期内,窗口载入的所有的页面都是共享一个window.name的，每个页面对window.name都有读写的权限，window.name是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置")]),s._v(" "),a("p",[a("code",[s._v("window.name的值只能是字符串的形式，这个字符串的大小最大只能允许2M左右")])]),s._v(" "),a("h3",{attrs:{id:"_7、postmessage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、postmessage"}},[s._v("#")]),s._v(" 7、postMessage")]),s._v(" "),a("p",[s._v("两个页面之间的相互通信；")]),s._v(" "),a("p",[s._v("A页面上有一个ifram标签B页面：")]),s._v(" "),a("ol",[a("li",[s._v("根据id名获得ifram的contentWindow。")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用$('myIFrame').contentWindow来拿到iframe中页面的window对象，")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" iframe "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myIFrame'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("2.使用postMessage方法传值。message：信息；domain：地址")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("B页面监听message事件；")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//监听message事件发生")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 可以将监听发送目标的信息来源;")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("origin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://localhost:8080'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'B我收到了:  '")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 也可以返回给A发送消息；格式一样：targetWindow .postMessage（message，targetOrigin，[ transfer ]）;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// event.source.postMessage('B收到消息了：', event.origin);")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("code",[s._v("window.postMessage(message,targetOrigin)")]),s._v(" 方法是html5新引进的特性，可以使用它来向其它的window对象发送消息，无论这个window对象是属于同源或不同源\n"),a("code",[s._v("postMessage(data,origin)方法接受两个参数")])]),s._v(" "),a("ol",[a("li",[a("p",[a("code",[s._v("data:要传递的数据，")]),s._v("html5规范中提到该参数可以是JavaScript的任意基本类型或可复制的对象，然而并不是所有浏览器都做到了这点儿，部分浏览器只能处理字符串参数，所以我们在传递参数的时候需要使用JSON.stringify()方法对对象参数序列化，在低版本IE中引用json2.js可以实现类似效果。")])]),s._v(" "),a("li",[a("p",[s._v('origin：字符串参数，指明目标窗口的源，协议+主机+端口号[+URL]，URL会被忽略，所以可以不写，这个参数是为了安全考虑，postMessage()方法只会将message传递给指定窗口，当然如果愿意也可以建参数设置为"*"，这样可以传递给任意窗口，如果要指定和当前窗口同源的话设置为"/"。')])])]),s._v(" "),a("h3",{attrs:{id:"_8、websocket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、websocket"}},[s._v("#")]),s._v(" 8、webSocket")]),s._v(" "),a("p",[a("code",[s._v("Websocket是HTML5的一个持久化的协议")]),s._v("，它实现了浏览器与服务器的全双工通信，同时也是跨域的一种解决方案。WebSocket和HTTP都是应用层协议，都基于 TCP 协议。但是 WebSocket 是一种双向通信协议，在建立连接之后，WebSocket 的 server 与 client 都能主动向对方发送或接收数据。同时，"),a("code",[s._v("WebSocket 在建立连接时需要借助 HTTP 协议，连接建立好了之后 client 与 server 之间的双向通信就与 HTTP 无关了")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v("0：正在连接")]),s._v(" "),a("li",[s._v("1：连接成功")]),s._v(" "),a("li",[s._v("2：正在关闭连接")]),s._v(" "),a("li",[s._v("3：已经关闭连接")])])])}),[],!1,null,null,null);t.default=e.exports}}]);